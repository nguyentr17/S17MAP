---
title: "Hypothesis_Testing_Gender"
author: "Yuan Wang"
date: "2/6/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(plyr)
library(dplyr)
library(rmarkdown)
library(rprojroot)
library(ggplot2)
library(mosaic)
library(data.table)
```

## Import and Trim Data

We use only untimed data with non-zero time used recording.

```{r}
shape <- fread("http://kuiper.pearsoncmg.com/shapesplosion/webreporter.php?game=PerfectionFlash&groupID=&winlose=both&random=false&rows=&type=csv")
shape_untime = shape[shape$requestedTime==0,]
shape_untimed = shape_untime[shape_untime$timeUsed!=0,]
```

We also changed some numerical variables to factors since they have only a fixed number of levels. We also changed the unit of the time data from milliseconds to seconds.

```{r}
shape_untimed$numShapes = as.factor(shape_untimed$numShapes)
shape_untimed$matchingScheme = as.factor(shape_untimed$matchingScheme)
shape_untimed$requestedTime = as.factor(shape_untimed$requestedTime)
shape_untimed$timeUsed = as.numeric(shape_untimed$timeUsed)
shape_untimed$timerDisplay = as.factor(shape_untimed$timerDisplay)
shape_untimed$numErrors = as.numeric(shape_untimed$numErrors)

shape_untimed_sec <-mutate(shape_untimed, TimeUsedSec = shape_untimed$timeUsed/1000)
```

We further trimed the data to include a varible column named Gender. 

```{r}
gender <- filter(shape_untimed, tolower(strtrim(shape_untimed$v1label,3))=="gen" |
                   tolower(strtrim(shape_untimed$v1label,3))=="sex" |
                   tolower(strtrim(shape_untimed$v1label,4))=="male" |
                   tolower(strtrim(shape_untimed$v1label,1))=="f")

case <- (tolower(strtrim(gender$v1value,1)) == "m") & (tolower(strtrim(gender$v2value,1)) =="f")
gender1 <- gender[(strtrim(gender$v1value,1) != "1") &
                    (gender$v1value != "2") &
                    (gender$v1label != "Gender\rOrder") &
                    (gender$v1label != "female\rorder") &
                    (gender$v1value != "0") &
                    (tolower(gender$v1value) != "morf") &
                    (gender$studentID != "mb") &
                    (gender$studentID != "31207") &
                    (gender$v1value != "cat") &
                    (gender$studentID != "3659") &
                    (tolower(gender$v1value) != "attempt") &
                    (!case),]

gender1 <- mutate(gender1, 
                  gender = as.factor(ifelse(
                    pmax((tolower(strtrim(gender1$v1label,1)) == "m"),
                         (tolower(strtrim(gender1$v1value,1)) =="m")), 
                    1, 
                    ifelse(pmax(tolower(strtrim(gender1$v1label,1)) == "f",
                                (tolower(strtrim(gender1$v1value,1)) =="f")), 
                           0, 
                           NA))))

gender2 <- na.omit(gender1)

```

Then, within the gender data, we identified the group names with sample size between 25 and 50. We make a vector of groupID of our desired groups.

```{r}
tb =as.data.frame(table(gender1$groupID))
tb <- tb[order(-tb$Freq),]
tb = tb[tb$Freq > 25,]
tb = tb[tb$Freq <= 50,]

tb2 <- filter(tb, tb$Freq >= 25 & tb$Freq <= 50)

selected_groupID <- tb2$Var1
```

We will write a function to conduct hypothesis testing on different groups 
