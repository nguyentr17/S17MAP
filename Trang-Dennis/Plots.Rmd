---
title: "Tangram Data Plots"
author: "Dennis Liu, Trang Nguyen"
date: "1/23/2016"
output: html_document
---

First, we want to import the dataset to R
```{r,, message=FALSE, warning=FALSE}
require(treemap)
require(dplyr) 
require(mosaic)
library(ggplot2)
library(data.table)
tangrams_data <- fread("http://statgames.tietronix.com/tangrams/webreporter.php?game=tangrams&groupID=&winlose=both&random=false&rows=&type=csv")
tangrams_data$HintsEnabled <- as.factor(tangrams_data$HintsEnabled)
tangrams_data$HintsUsed <- as.factor(tangrams_data$HintsUsed)
```

First, we want to take an initial look on the relationship between hint used and time. 

```{r}
 xyplot( TimeUsed ~ HintsUsed  |  HintsEnabled, data = tangrams_data, main="") 
```

We do notice that there is several outliners in both facets. It may be caused by the delay of the internet or crash d the web flash widget. Now,we want to take out those outliners. 
```{r}
tangramfilter <- tangrams_data[tangrams_data$TimeUsed < 10000,]
tangramfilter <- tangramfilter[tangramfilter$TimeUsed > 0,]
xyplot( TimeUsed ~ HintsUsed  |  HintsEnabled, data = tangramfilter, main="") 
```
We also notice that there are so many levels of Tangram type. Now, we want to take a closer look into this. we want to select sepcific dataset in order to take an initial look 
```{r}
tangram2 <- as.data.frame(table(tangramfilter$PuzzleName))
colnames(tangram2) <- c("PuzzleName", "Freq")

## colored by types of games: fixed or submitted
statsgame <- c("Laughing Man", "Piano", "The Hook", "Complex Hexagon", "Diamond", "House of Tangrams",
               "A Nice Lighthouse", "The Brain Buster", "A Simple Chair", "The Hat Wearer",
               "The Acrobat", "The Bird", "Crouching Cat", "The Goat", "The Six", "The G",
               "Andy's Puzzle", "Walking Person Puzzle", "A Medicine Jar", "Candle")
tangram2$GameType <- "submitted"
tangram2$GameType[tangram2$PuzzleName %in% statsgame] <- "statsgame"
```


Now we want to utilize the tree map package to make a graph

```{r}
treemap(tangram2, index = "PuzzleName", 
         vSize = "Freq",
         vColor = "GameType",
         type = "categorical")
```
    
    
We notice that there are significant data entries including gender information. We want to categorize those information. We create another column with gender information. 

# sex in gender
```{r}
tangram <- tangramfilter
gen_tangram1 <- tangram[tolower(strtrim(tangram$Factor1,3)) == "gen",]
gen_tangram1$gender[tolower(strtrim(gen_tangram1$Level1,1)) == "m" | tolower(strtrim(gen_tangram1$Level1,1)) == "h"] <- "M"
gen_tangram1$gender[tolower(strtrim(gen_tangram1$Level1,1)) == "f" | tolower(strtrim(gen_tangram1$Level1,2)) == "mu"] <- "F"

gen_tangram2 <- tangram[tolower(strtrim(tangram$Factor2,3)) == "gen",]
gen_tangram2$gender[tolower(strtrim(gen_tangram2$Level2,1)) == "m" | tolower(strtrim(gen_tangram2$Level2,1)) == "h"] <- "M"
gen_tangram2$gender[tolower(strtrim(gen_tangram2$Level2,1)) == "f" | tolower(strtrim(gen_tangram2$Level2,2)) == "mu"] <- "F"


gen_tangram3 <- tangram[tolower(strtrim(tangram$Factor3,3)) == "gen",]
gen_tangram3$gender[tolower(strtrim(gen_tangram3$Level3,1)) == "m" | tolower(strtrim(gen_tangram3$Level3,1)) == "h"] <- "M"
gen_tangram3$gender[tolower(strtrim(gen_tangram3$Level3,1)) == "f" | tolower(strtrim(gen_tangram3$Level3,2)) == "mu"] <- "F"

gen_tangram <- rbind(gen_tangram1,gen_tangram2,gen_tangram3)
gen_tangram$gender <- as.factor(gen_tangram$gender)
gen_tangram <- gen_tangram[is.na(gen_tangram$gender) != 1,]
```

Now, we want to take another look on the updated dataset.

```{r}
 bwplot( TimeUsed ~ gender, data = gen_tangram, main="") 
```
 We also want to make a treemap for this updated data. However, we are only looking at the build in puzzle for tangrams. 
 
```{r}
gen_tangram_statsgame <- gen_tangram[gen_tangram$PuzzleName %in% statsgame,]
gen_tangram_count <- count_(gen_tangram_statsgame,"PuzzleName")
treemap(gen_tangram_count, index = "PuzzleName", 
         vSize = "n")
```
  
We are also interest in the gender difference within one game. In order to do that, we plot a double bar chart. With the y-axis as the average of Time_used and the X-axis as Puzzle Name. 
```{r}
gen_tangram_statsgame <- gen_tangram[gen_tangram$PuzzleName %in% statsgame,]
gen_tangram_count <- count_(gen_tangram_statsgame,"PuzzleName")
gen_tangram_count <- gen_tangram_count[order(-gen_tangram_count$n),]
ggplot(gen_tangram_statsgame[gen_tangram_statsgame$PuzzleName %in% head(gen_tangram_count$PuzzleName,5),], aes(fill = gender, y = TimeUsed, x = PuzzleName)) +
  geom_bar(position = "dodge", stat = "identity")

```

